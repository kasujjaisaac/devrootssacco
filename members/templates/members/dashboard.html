{% extends "base.html" %}
{% load static %}

{% block title %}Member Dashboard{% endblock %}

{% block content %}
<div class="container-fluid" style="font-family: 'Poppins', sans-serif;">

    <!-- =======================
        TOP STAT CARDS
    ======================== -->
    <div class="row mb-4 g-4">
        <!-- Profile Card -->
        <div class="col-md-3 text-start d-flex flex-column align-items-center">
            <img src="{% if member.profile_pic %}{{ member.profile_pic.url }}{% else %}{% static 'img/default-avatar.png' %}{% endif %}" 
                 alt="Profile Picture" class="profile-pic mb-2">
            <h6>{{ member.first_name }} {{ member.last_name }}</h6>
            <p class="text-muted">{{ member.member_id }}</p>
        </div>

        <!-- Account Balance -->
        <div class="col-md-3">
            <div class="card stat-card border-0 shadow-sm p-3 text-start">
                <h6 class="text-muted">Account Balance</h6>
                <h3 class="fw-bold">
                    UGX 
                    {% if account %}
                        {{ account.balance|floatformat:2 }}
                    {% else %}
                        0.00
                    {% endif %}
                </h3>
            </div>
        </div>

        <!-- Total Transactions -->
        <div class="col-md-3">
            <div class="card stat-card border-0 shadow-sm p-3 text-start">
                <h6 class="text-muted">Total Transactions</h6>
                <h3 class="fw-bold">{{ transactions|length }}</h3>
            </div>
        </div>

        <!-- Member Status -->
        <div class="col-md-3">
            <div class="card stat-card border-0 shadow-sm p-3 text-start">
                <h6 class="text-muted">Status</h6>
                <h3 class="fw-bold">{{ member.status }}</h3>
            </div>
        </div>
    </div>

    <!-- =======================
        PROFILE & ACCOUNT SECTION
    ======================== -->
    <div class="row g-4">
        <!-- Profile Info -->
        <div class="col-md-6">
            <div class="card shadow-sm rounded-3">
                <div class="card-header green-header">Member Profile</div>
                <div class="card-body text-start">
                    <p><strong>Phone:</strong> {{ member.phone }}</p>
                    <p><strong>Email:</strong> {% if member.email %}{{ member.email }}{% else %}-{% endif %}</p>
                </div>
            </div>
        </div>

        <!-- Savings Account -->
        <div class="col-md-6">
            <div class="card shadow-sm rounded-3">
                <div class="card-header green-header">Savings Account</div>
                <div class="card-body text-start">
                    <p><strong>Current Balance:</strong> UGX 
                        {% if account %}
                            {{ account.balance|floatformat:2 }}
                        {% else %}
                            0.00
                        {% endif %}
                    </p>
                    <p><strong>Recent Balance:</strong> UGX 
                        {% if account %}
                            {{ recent_balance|floatformat:2 }}
                        {% else %}
                            0.00
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- =======================
        RECENT TRANSACTIONS
    ======================== -->
    <div class="card shadow-sm mb-5 rounded-3 mt-4">
        <div class="card-header green-header">Recent Transactions</div>
        <div class="card-body text-start">
            {% if transactions %}
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-success">
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Balance After</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tx in transactions %}
                            <tr>
                                <td>{{ tx.transaction_date|date:"d M Y H:i" }}</td>
                                <td>{{ tx.transaction_type }}</td>
                                <td>UGX {{ tx.amount|floatformat:2 }}</td>
                                <td>UGX {{ tx.balance_after_transaction|floatformat:2 }}</td>
                                <td>{% if tx.description %}{{ tx.description }}{% else %}-{% endif %}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <p class="text-muted">No transactions found.</p>
            {% endif %}
        </div>
    </div>

    <!-- =======================
        RECENT ACTIVITY
    ======================== -->
    <div class="card shadow-sm rounded-3 mb-5">
        <div class="card-header green-header">Recent Activity</div>
        <div class="card-body p-0 text-start">
            {% if recent_logs %}
                <ul class="list-group list-group-flush">
                    {% for log in recent_logs %}
                        <li class="list-group-item">
                            <strong>{{ log.action }}</strong>
                            <br>
                            <small class="text-muted">{{ log.timestamp|date:"Y-m-d H:i" }} | IP: {% if log.ip_address %}{{ log.ip_address }}{% else %}-{% endif %}</small>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="p-3 text-muted">No activity yet.</p>
            {% endif %}
        </div>
    </div>

</div>

<!-- =======================
    CUSTOM CSS
======================= -->
<style>
.green-header {
    background: rgba(3, 104, 39, 0.795);
    color: white;
    font-weight: 600;
    padding: 12px 16px;
    border-radius: 6px 6px 0 0;
}

.stat-card {
    border-left: 5px solid rgba(3, 104, 39, 0.795);
    border-radius: 8px;
    transition: transform 0.2s;
}
.stat-card:hover { transform: translateY(-3px); }

.table th, .table td { vertical-align: middle; }

/* Profile picture round & nice border */
.profile-pic {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(3, 104, 39, 0.8);
}


body, h6, h3, p, td, th { font-family: 'Poppins', sans-serif; text-align: left !important; }

@media (max-width: 768px) {
    .stat-card { margin-bottom: 1rem; text-align: left !important; }
    .table-responsive { overflow-x: auto; }
    .profile-pic { width: 100px; height: 100px; }
}
</style>

{% endblock %}
